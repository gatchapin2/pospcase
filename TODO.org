
#+SEQ_TODO: TODO(t!) NOTE(n!) | DONE(d!) HALT(h!)
* Bugs
** TODO Known reader macros so far
   - State "TODO"       from              [2018-11-21 Wed 01:42]
   - #\char
   - #H() from cl21
   - #!?[-+]sym
   - #(1 2 3)

** TODO replace-regex-in-string ideas [5/5]
   - State "TODO"       from              [2018-11-21 Wed 01:42]
   - [X] "#\\" -> " ?", a half assed char conversion
   - [X] "#[^ (]+(" -> "(", for cl21 hash
   - [X] "#p\"" -> "\"", pathname
   - [X] "#\\+" -> "  "
   - [X] "#|foo|#" -> "/*   */"

** TODO large body sluggishness
   - State "TODO"       from              [2018-11-30 Fri 16:48]

   - need jit-lock internal understanding

* Features
** TODO Use as much ~pcase~ as possible
   - State "TODO"       from              [2018-11-19 Mon 12:27]
** TODO elispification
   - State "TODO"       from              [2018-11-19 Mon 13:34]
** submatcher generator
   - Something like:

     #+BEGIN_SRC emacs-lisp
       (pospcase-font-lock ’lisp-mode
                            '(`(defun ,name ,args))
                            '((name . font-lock-function-name-face)
                              ((args . (`(,arg ,type)
                                        `,arg)))
                              ((arg . font-lock-function-name-face)
                               (type . font-lock-type-face))))
     #+END_SRC

     and it calls

     #+BEGIN_SRC emacs-lisp
       (goto-char (car args))
       (pospcase-font-lock-submatcher (`(,arg ,type)
                                       `,arg))
     #+END_SRC
** TODO add chop-off-p to pospcase-read
   - State "TODO"       from              [2018-11-21 Wed 05:44]

*** TODO detect trailing ". ,__)", attach closing parens for read-from-string

    - State "TODO"       from              [2018-11-21 Wed 05:44]
*** TODO use syntax-table

    - State "TODO"       from              [2018-11-23 Fri 08:49]

    #+BEGIN_SRC emacs-lisp
    (insert (make-string
         (car (parse-partial-sexp (point) (+ (point) 10)))
         ?\)))
    (foo (bar (baz (qux (quux
    #+END_SRC

*** TODO pospcase--buffer-substring
    - State "TODO"       from              [2018-11-29 Thu 14:42]

    #+BEGIN_SRC emacs-lisp
      (let ((str (buffer-substring-no-properties (point) limit))
            newstr)
        (with-temp-buffer
          (insert str)
          (goto-char (point-max))
          (insert (make-string (car (syntax-ppss)) ?\)))
          (setq pospcase--buffer-substring (buffer-substring (point-min) (point-max)))))
    #+END_SRC


*** TODO Entry point should be ~pospcase-at.~ Because ~pospcase-read~ and ~pospcase~ aren’t aware of current patterns.
    - State "TODO"       from              [2018-11-30 Fri 09:58]

*** TODO ~pospcase-read~ walk down the sexp tree. How should it behave when chop-off point comes?
    - State "TODO"       from              [2018-11-30 Fri 10:00]
** TODO define ~pospcase--after-open-paren~
   - State "TODO"       from              [2018-11-23 Fri 11:11]

     #+BEGIN_SRC emacs-lisp
       (let ((limit (point-max))
             (keyword "defun"))
         (when (search-forward keyword limit t)
           (let ((kw-begin (match-beginning 0))
                 (kw-end (match-end 0))
                 begin end)
             (and
              (looking-at "[ \t\n;]")
              (setq end (match-end 0))
              (search-backward "(" nil t)
              (setq begin (match-beginning 0))
              (progn
                (goto-char (match-end 0))
                (forward-comment most-positive-fixnum)
                (= (point) kw-begin))
              (set-match-data (list begin end
                                    kw-begin kw-end)))))
         (match-string 1))

       ;;; bar
       (
       ;;; foo
       defun foo (bar) baz)
     #+END_SRC
** TODO Primary matcher should use pcase too?
   - State "TODO"       from              [2018-11-23 Fri 14:13]

   - Example: `((or labels cl-labels) ,name ,args . ,__)
* Documentation
** NOTE should I mention the difference between ~pospcase-read~ and ~read-symbol-positions-list~ ?
   - State "NOTE"       from              [2018-12-02 Sun 04:10]

   #+BEGIN_SRC emacs-lisp
     (let ((read-with-symbol-positions t))
       (read "(foo (foo))")
       read-symbol-positions-list)
   #+END_SRC

* Design guideline
** NOTE errors
   - State "NOTE"      from              [2018-11-22 Thu 10:32]

   - Generic functions like ~pospcase~, ~pospcase-at~, ~pospcase-read~
     shouldn't silently discard errors like ~scan-error~ for unmatched
     parenthesis, ~invalid-read-syntax~ for unparsable buffer segment
     even after elispification.

   - Externally exposed font-lock functions (submatchers, preform,
     postform, etc.) and macros should discard errors silently.

   - How about internal font-lock functions (iterator, etc)?
** TODO use idioms
   - State "TODO"       from              [2018-11-29 Thu 11:24]
   - use push

     #+BEGIN_SRC emacs-lisp
       (cl-loop with result do (setq result (append result (walk))))
     #+END_SRC

     should be

     #+BEGIN_SRC emacs-lisp
       (cl-loop with result do (push (walk) result))
     #+END_SRC
** TODO ~read-from-string~ should be major-mode aware? In case someone use (pred vectorp) in emacs-lisp-mode?
   - State "TODO"       from              [2018-11-30 Fri 09:37]
** TODO ~down-list~ is major-mode aware. Does ~elispify~ cause inconsistency?
   - State "TODO"       from              [2018-11-30 Fri 09:43]
